<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Begin Jekyll SEO tag v2.4.0 -->
<title>Don’t add Django migrations to version control | The Chiwbaka</title>
<meta name="generator" content="Jekyll v3.7.2" />
<meta property="og:title" content="Don’t add Django migrations to version control" />
<meta name="author" content="admin" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Django docs recommend a lot of things which don’t really work out in reality." />
<meta property="og:description" content="Django docs recommend a lot of things which don’t really work out in reality." />
<link rel="canonical" href="http://localhost:4000/2017/03/30/dont-add-django-migrations-version-control.html" />
<meta property="og:url" content="http://localhost:4000/2017/03/30/dont-add-django-migrations-version-control.html" />
<meta property="og:site_name" content="The Chiwbaka" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-03-30T16:11:58+02:00" />
<script type="application/ld+json">
{"headline":"Don’t add Django migrations to version control","dateModified":"2017-03-30T16:11:58+02:00","datePublished":"2017-03-30T16:11:58+02:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2017/03/30/dont-add-django-migrations-version-control.html"},"author":{"@type":"Person","name":"admin"},"description":"Django docs recommend a lot of things which don’t really work out in reality.","@type":"BlogPosting","url":"http://localhost:4000/2017/03/30/dont-add-django-migrations-version-control.html","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  <link rel="stylesheet" href="/assets/main.css">
  <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="The Chiwbaka" />
  
</head>


  <body>

    <header class="site-header" role="banner">

  <div class="wrapper">
    
    
    <a class="site-title" rel="author" href="/">The Chiwbaka</a>

    
      <nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
              <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
              <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
          
            
            
          
            
            
            <a class="page-link" href="/contact.html">Contact</a>
            
          
            
            
          
            
            
          
            
            
          
        </div>
      </nav>
    
  </div>
</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Don&#39;t add Django migrations to version control</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2017-03-30T16:11:58+02:00" itemprop="datePublished">
        
        Mar 30, 2017
      </time>
      
        • <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">admin</span></span>
      </p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>Django docs recommend a lot of things which don’t really work out in reality.</p>

<p>For instance, having a single settings.py file. The only reason I can think of having it this way is so as not to overwhelm newcomers, because you need different settings for dev, production and staging.
A single tests.py for an app. Seriously, guys? You need test_views.py, test_models.py, test_manager.py, at least.</p>

<p>And here’s the one thing that might be useful, might not: committing your migrations to version control.</p>

<p>Here’s the situation: you’re working on the models for a Django app.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class Dog(models.Model):
    owner = models.ForeignKey(Person, on_delete=models.CASCADE)
    name = models.CharField(max_length=255)
    age = models.IntegerField()
</code></pre></div></div>

<p>Hmm, perhaps age should be date-of-birth. After all, you don’t want to have to write some script to be updating the age value for every dog every year. No, perhaps it should be named dob after all.</p>

<p>So you make the change in models.py and add the migrations for the changes as well, they get saved as 0002_renamed_age_to_dob.py or something.</p>

<p>Problem is, your colleague has been working on the very same model, and he had added some other fields too:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class Dog(models.Model):
    owner = models.ForeignKey(Person, on_delete=models.CASCADE)
    name = models.CharField(max_length=255)
    dob = models.DateField()
    fav_foods = models.CharField(max_length=255, blank=True)
    potty_trained = models.BooleanField(default=False)
</code></pre></div></div>

<p>The migration that changes the first code snippet to the second in PostgreSQL gets saved as 0002_added_fields.py, and now your django-migrate fails after a git pull. Because 0002_added_fields.py assumes that age is still there and it’s a models.IntegerField, but the database on your machine looks different because you already renamed age to dob. Git can resolve conflicts between your models.py, but not between the Django migrations.</p>

<p>So it’s best to just not add those migrations to the code repository unless you’re really sure that only one guy is working on the models. Because if more than one guy is working on the models, then everybody’s databases are different and the migrations can’t resolve that. You might as well do django-manage makemigrations from scratch.</p>

<p>Unless, of course, you already have data in there.</p>

  </div>

  

  <a class="u-url" href="/2017/03/30/dont-add-django-migrations-version-control.html" hidden></a>
</article>

      </div>
    </main>

    <footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">The Chiwbaka</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">
            
              The Chiwbaka
            
            </li>
            
            <li><a class="u-email" href="mailto:andrew.work0@gmail.com">andrew.work0@gmail.com</a></li>
            
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
  
  
  
  <li><a href="https://github.com/randomshinichi"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">randomshinichi</span></a></li>
  
  
  
  <li><a href="https://www.twitter.com/randomshinichi"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">randomshinichi</span></a></li>
  
  
  
</ul>

      </div>

      <div class="footer-col footer-col-3">
        <p>Developer and crypto enthusiast.</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
